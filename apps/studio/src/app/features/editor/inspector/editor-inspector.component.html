<div class="pane pane--inspector">
  <div class="pane-title">Inspector</div>

  <div class="inspector-section">
    <ng-container *ngIf="selectedTargetId; else noTarget">
      <div class="inspector-card card--summary" *ngIf="selectedLayoutElement as el">
        <div class="summary-line">
          <span class="summary-strong">Key {{ selectedTargetId }}</span>
          <span class="summary-divider">&middot;</span>
          <span>Layer {{ activeLayer }}</span>
          <span class="summary-divider">&middot;</span>
          <span>Type: {{ isControlElement(el) ? el.kind : 'Key' }}</span>
        </div>
      </div>

      <div class="inspector-card card--binding">
        <div class="card-heading">
          <div>
            <div class="card-label">Binding</div>
            <div class="card-title">{{ selectedSequanceName || 'None' }}</div>
          </div>
        </div>

        <div class="field">
          <label class="field-label">Binding Type</label>
          <select
            class="full"
            aria-label="Binding type"
            [value]="bindingType"
            (change)="bindingTypeChange.emit($any($event.target).value)"
          >
            <option value="sequanceRef">Sequance</option>
            <option value="program">Program</option>
            <option value="inlineSequence">Text macro</option>
            <option value="simpleAction">Simple action</option>
            <option value="none">None</option>
          </select>
        </div>

        <div class="field" *ngIf="bindingType === 'sequanceRef'">
          <label class="field-label" for="binding-sequance">Sequance</label>
          <select
            class="full"
            id="binding-sequance"
            [value]="bindingSequanceId || ''"
            (change)="bindingSequanceChange.emit($any($event.target).value)"
            [attr.aria-invalid]="bindingErrors.length ? 'true' : null"
          >
            <option value="" disabled>Select sequance</option>
            <option *ngFor="let s of sequancesForProfile" [value]="s.id">
              {{ s.name }}
            </option>
          </select>
        </div>

        <div class="field" *ngIf="bindingType === 'simpleAction'">
          <label class="field-label">Action</label>
          <input
            class="full"
            type="text"
            list="action-suggestions"
            [value]="bindingAction"
            (input)="bindingActionChange.emit($any($event.target).value)"
            placeholder="e.g., TAP KC_SPACE"
            [attr.aria-invalid]="bindingErrors.length ? 'true' : null"
            aria-describedby="simple-action-hint"
          />
          <datalist id="action-suggestions">
            <option *ngFor="let a of actions" [value]="a"></option>
          </datalist>
          <input
            class="full"
            type="text"
            [value]="bindingActionArg"
            (input)="bindingActionArgChange.emit($any($event.target).value)"
            placeholder="Optional arg"
          />
          <div class="hint" id="simple-action-hint">Simple, single action (tap key, click, wait).</div>
        </div>

        <div class="field" *ngIf="bindingType === 'program'">
          <label class="field-label">Program path</label>
          <input
            class="full"
            type="text"
            [value]="bindingProgramPath"
            (input)="bindingProgramPathChange.emit($any($event.target).value)"
            placeholder="C:\\Path\\to\\app.exe"
            [attr.aria-invalid]="bindingErrors.length ? 'true' : null"
            aria-describedby="program-path-hint"
          />
          <div class="hint" id="program-path-hint">Use an executable path that the OS can open.</div>
        </div>

        <div class="field" *ngIf="bindingType === 'inlineSequence'">
          <label class="field-label">Text macro</label>
          <textarea
            class="full"
            rows="4"
            [value]="bindingInlineText"
            (input)="bindingInlineTextChange.emit($any($event.target).value)"
            placeholder="Text to type when pressed"
            [attr.aria-invalid]="bindingErrors.length ? 'true' : null"
            aria-describedby="inline-sequence-hint"
          ></textarea>
          <div class="hint" id="inline-sequence-hint">Plain text that will be typed when triggered.</div>
        </div>

        <div class="field errors" *ngIf="bindingErrors.length" role="alert" aria-live="polite">
          <div class="error" *ngFor="let err of bindingErrors">{{ err }}</div>
        </div>

        <div class="binding-actions stack">
          <button
            class="btn primary full"
            type="button"
            (click)="assign.emit()"
            [disabled]="!selectedTargetId || !!bindingErrors.length"
          >
            Assign
          </button>
          <button
            class="btn ghost full"
            type="button"
            (click)="clear.emit()"
            [disabled]="!selectedTargetId"
          >
            Clear
          </button>
        </div>
      </div>

      <div class="inspector-card card--context">
        <div class="context-header" (click)="contextOpen = !contextOpen">
          <span class="card-label">Context</span>
          <span class="chevron" [class.open]="contextOpen">âŒ„</span>
        </div>
        <div class="context-body" *ngIf="contextOpen && selectedLayoutElement as el">
          <div class="context-pill" *ngIf="!isControlElement(el)">Key options: Macro, Tap, Hold</div>
          <div class="context-pill" *ngIf="isControlElement(el)">Encoder options: CC, Volume, Scroll</div>
        </div>
      </div>
    </ng-container>
    <ng-template #noTarget>
      <div class="inspector-card empty-target ghost-card">
        <div class="ghost-icon">dYZ_</div>
        <div class="ghost-title">Pick something to edit</div>
        <div class="ghost-text">Click a key or encoder block on the canvas to start.</div>
      </div>
    </ng-template>
  </div>

  <div class="inspector-section" *ngIf="showSelectionSection">
    <div class="inspector-label">Selection</div>

    <div class="inspector-empty" *ngIf="!selectedStep">Select a step to edit.</div>

    <div class="inspector-card" *ngIf="selectedStep as step">
      <div class="row">
        <div class="k">Step</div>
        <div class="v">#{{ step.id }}</div>
      </div>
      <div class="row">
        <div class="k">Name</div>
        <div class="v">{{ step.name }}</div>
      </div>
      <div class="row">
        <div class="k">Op</div>
        <div class="v">{{ step.op }}</div>
      </div>
      <div class="row" *ngIf="step.arg">
        <div class="k">Arg</div>
        <div class="v">{{ step.arg }}</div>
      </div>
      <div class="row" *ngIf="step.class">
        <div class="k">Delay Class</div>
        <div class="v">C{{ step.class }}</div>
      </div>
    </div>
  </div>
</div>
