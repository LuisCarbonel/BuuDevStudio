<div class="workbench">
  <app-editor-header
    *ngIf="vm$ | async as vm"
    [connected]="vm.connected"
    [busy]="vm.busy"
    [running]="vm.running"
    [ramLoaded]="vm.ramLoaded"
    [dirty]="syncStats.dirty"
    [appliedInSync]="appliedInSync"
    [deviceName]="deviceName"
    [sessionId]="syncStats.sessionId"
    [revision]="syncStats.committed?.revision ?? null"
    [layerOptions]="layerOptions"
    [activeLayer]="activeLayer"
    [libraryOpen]="libraryOpen"
    (toggleLibrary)="toggleLibrary()"
    (selectLayer)="setLayer($event)"
    (connect)="device.connect()"
    (disconnect)="device.disconnect()"
    (upload)="device.uploadToRam()"
    (revert)="device.revertRam()"
    (commit)="device.commitToFlash()"
    (run)="device.run()"
    (stopAll)="device.stopAll()"
  ></app-editor-header>

  <div
    class="wb-body"
    [class.library-closed]="!libraryOpen"
  >
    <app-editor-library
      *ngIf="libraryOpen"
      [profiles]="profiles"
      [selectedProfileId]="selectedProfile?.id || null"
      [sequancesForProfile]="sequancesForProfile"
      [selectedSequanceId]="selectedSequance?.id || null"
      [actions]="actions"
      [presets]="presets"
      (selectProfile)="selectProfile($event)"
      (selectSequance)="selectSequance($event)"
    ></app-editor-library>

    <app-editor-canvas
      [normalizedLayout]="normalizedLayout"
      [layoutMode]="layoutMode"
      [layoutUnitPx]="layoutUnitPx"
      [layoutSelectionId]="layoutSelectionId"
      [hoveredElementId]="hoveredElementId"
      (toggleLayoutMode)="toggleLayoutMode()"
      (select)="onDeviceSelect($event)"
      (deselect)="onDeviceDeselect()"
      (hover)="onDeviceHover($event)"
      (moveDelta)="onDeviceMove($event)"
      (assignDrop)="onDropAssign($event.targetId, $event.payload)"
    ></app-editor-canvas>

    <app-editor-inspector
      [selectedTargetId]="selectedTargetId"
      [selectedLayoutElement]="selectedLayoutElement"
      [assignedTargetIds]="assignedTargetIds"
      [activeLayer]="activeLayer"
      [selectedSequanceName]="selectedSequance?.name || null"
      [bindingType]="bindingType"
      [bindingSequanceId]="bindingSequanceId"
      [bindingAction]="bindingAction"
      [bindingActionArg]="bindingActionArg"
      [bindingInlineText]="bindingInlineText"
      [bindingProgramPath]="bindingProgramPath"
      [bindingErrors]="bindingErrors"
      [sequancesForProfile]="sequancesForProfile"
      [actions]="actions"
      [selectedStep]="selectedStep"
      (bindingTypeChange)="bindingType = $event"
      (bindingSequanceChange)="onBindingSequanceChange($event)"
      (bindingActionChange)="bindingAction = $event"
      (bindingActionArgChange)="bindingActionArg = $event"
      (bindingInlineTextChange)="bindingInlineText = $event"
      (bindingProgramPathChange)="bindingProgramPath = $event"
      (assign)="assignSelectedSequanceToTarget()"
      (clear)="clearBinding()"
    ></app-editor-inspector>
  </div>
</div>
