<div class="pane pane--canvas">
  <div class="pane-title">Canvas</div>

  <div class="canvas-tabs">
    <button
      class="tab"
      type="button"
      [class.active]="canvasView === 'device'"
      (click)="setView('device')"
    >
      Device View
    </button>
    <button
      class="tab"
      type="button"
      [class.active]="canvasView === 'sequence'"
      [disabled]="!hasSequence"
      [attr.aria-disabled]="!hasSequence ? 'true' : null"
      (click)="setView('sequence')"
    >
      Sequence View
    </button>
  </div>

  <div class="layout-toolbar">
    @if (layerOptions.length) {
      <div class="layer-switch">
        <span class="label">Layer:</span>
        <div class="pill-group studio-layer-toggle">
          @for (layer of layerOptions; track layer) {
            <button
              type="button"
              class="pill"
              [class.active]="layer === activeLayer"
              (click)="selectLayer.emit(layer)"
            >
              {{ layer }}
            </button>
          }
        </div>
      </div>
    }

    <div class="toolbar-actions">
      <nz-segmented
        class="view-toggle"
        [nzOptions]="viewOptions"
        nzSize="default"
        [ngModel]="segmentValue"
        (ngModelChange)="onViewChange($event)"
      ></nz-segmented>
      <span class="muted">Layout provided by connected device.</span>
    </div>
  </div>

  <div class="pane-body pane-body--canvas" #canvasViewport>
    @if (canvasView === 'device') {
      <div class="device-view" [class.device-view--fit]="fitToCanvas">
        @if (normalizedLayout) {
          <div
            cdkDropList
            id="canvasDrop"
            [cdkDropListSortingDisabled]="true"
            [cdkDropListEnterPredicate]="canvasEnterPredicate"
            (cdkDropListDropped)="onCanvasDropped($event)"
          >
            <app-device-view
              [layout]="normalizedLayout"
              [selection]="layoutSelectionId"
              [hoverId]="hoveredElementId"
              [unitPx]="effectiveUnitPx"
              [bindingIndicators]="bindingIndicators"
              [keycodeLabels]="keycodeLabels"
              [encoderLabels]="encoderLabels"
              [dropConnectedTo]="[]"
              [dropEnabled]="false"
              (pointerdown)="$event.stopPropagation()"
              (select)="select.emit($event)"
              (deselect)="deselect.emit()"
              (hover)="hover.emit($event)"
              (assignDrop)="onAssignDrop($event.targetId, $event.payload)"
            ></app-device-view>
          </div>
        } @else {
          <div class="canvas-placeholder">
            Connect to a device to load its layout.
          </div>
        }
      </div>
    }

    @if (canvasView === 'sequence') {
      <div class="device-view">
        <div class="canvas-placeholder">
          Select a step to edit.
        </div>
      </div>
    }
  </div>
</div>
