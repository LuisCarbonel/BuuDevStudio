<div class="recorder-page studio-scope--recorder">
  <!-- Header -->
  <header class="recorder-header">
    <div class="header-left">
      <div class="sequence-name-group">
        <input
          class="sequence-name-input"
          type="text"
          [value]="sequenceName()"
          (input)="onSequenceNameChange($event)"
          placeholder="Sequence name..."
          [disabled]="recording()"
        />
        @if (dirty()) {
          <span class="header-badge">Unsaved</span>
        }
        @if (recording()) {
          <span class="header-badge header-badge--recording">
            <span class="recording-dot"></span>
            Recording
          </span>
        }
      </div>
      <div class="header-hint">Click a key in the Library to append it to this sequence.</div>
    </div>

    <div class="header-actions">
      <!-- Recording controls -->
      <div class="action-group">
        <button
          nz-button
          nzType="primary"
          [nzDanger]="recording()"
          (click)="recording() ? stopRecording() : startRecording()"
        >
          @if (!recording()) {
            <span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="8"/>
              </svg>
              Record
            </span>
          }
          @if (recording()) {
            <span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="6" width="12" height="12" rx="2"/>
              </svg>
              Stop
            </span>
          }
        </button>
      </div>

      <div class="action-divider"></div>

      <!-- Save/Clear -->
      <div class="action-group">
        <button
          nz-button
          nzType="primary"
          [disabled]="!canSave()"
          (click)="saveToSequence()"
        >
          Save
        </button>
        <button
          nz-button
          [disabled]="!items().length"
          (click)="clearAll()"
        >
          Clear
        </button>
      </div>
    </div>
  </header>

  <!-- Main 3-panel layout -->
  <div class="recorder-body">
    <!-- Left: Library panel -->
    <aside class="panel panel--library">
      <app-editor-library
        [profiles]="profiles()"
        [selectedProfileId]="selectedProfileId()"
        [sequencesForProfile]="sequencesForProfile()"
        [selectedSequenceId]="selectedSequenceId()"
        [libraryMode]="libraryMode()"
        [librarySearch]="librarySearch()"
        [enableBlockClick]="true"
        [blockPreset]="'recorder'"
        (selectProfile)="onSelectProfile($event)"
        (selectSequence)="onSelectSequence($event)"
        (modeChange)="onLibraryModeChange($event)"
        (searchChange)="onLibrarySearchChange($event)"
        (createSequence)="onCreateSequence()"
        (blockClick)="onLibraryBlockClick($event)"
      ></app-editor-library>
    </aside>

    <!-- Middle: Sequence list -->
    <main class="panel panel--list">
      <app-recorder-sequence-list
        [items]="items()"
        [selectedId]="selectedId()"
        (select)="onSelectItem($event)"
        (reorder)="onReorder($event)"
        (addDelay)="onAddDelay()"
        (itemAction)="onItemAction($event)"
      ></app-recorder-sequence-list>
    </main>

    <!-- Right: Inspector -->
    <aside class="panel panel--inspector">
      <app-recorder-inspector
        [selectedItem]="selectedItem()"
        (strokeChange)="onStrokeChange($event)"
        (holdMsChange)="onHoldMsChange($event)"
        (delayMsChange)="onDelayMsChange($event)"
        (resetItem)="onResetItem()"
        (removeItem)="removeSelectedItem()"
      ></app-recorder-inspector>
    </aside>
  </div>
</div>
